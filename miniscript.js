var thiscolor=document.querySelector("#colorPickerMain").value,newColor=document.querySelectorAll(".colorPicker"),baseColor=document.querySelector("#base"),chosenColors=["#000000"],canvas=document.querySelector("#pixelCanvas");function init(e){reset(),createGrid(),updateFooter(),colorGrid(),updateBase(),updateColors(),draw(),selectDrawTool(),updateRecent(),updateMostUsed(),e.preventDefault()}function reset(){var e=document.querySelectorAll("#pixelCanvas > tr");if(document.querySelector("#colorPickerMain").value="#000000",0!==e.length)for(i=0;i<e.length;i++)document.querySelector("#pixelCanvas").deleteRow(i)}function createGrid(){for(var e=document.querySelector("#input_width").value,t=document.querySelector("#input_height").value,o=0;o<t;o++){var n=document.createElement("tr");canvas.appendChild(n);for(var r=0;r<e;r++){var c=document.createElement("td");n.appendChild(c)}}baseColor.value="#ffffff",document.querySelector("#pencil").classList.add("selected")}function colorGrid(){for(var e=document.querySelectorAll("td"),t=0;t<e.length;t++)e[t].style.background="#ffffff"}function updateBase(){var e=document.querySelectorAll("td");baseColor.addEventListener("change",function(t){for(var o=0;o<e.length;o++)e[o].style.background=baseColor.value})}function updateColors(){for(var e=0;e<newColor.length;e++)newColor[e].addEventListener("click",function(){""!=(thiscolor=colorToHex(this.style.backgroundColor))&&chosenColors.unshift(thiscolor),document.querySelector("#mostUsed").style.background=mostUsed(chosenColors)});document.querySelector("#colorPickerMain").addEventListener("change",function(){thiscolor=this.value})}function tools(){document.querySelector("#pencil").addEventListener("click",draw),document.querySelector("#eraser").addEventListener("click",function(e){document.querySelector("table").style.cursor="url('eraser.png'), auto";for(var t=document.querySelectorAll("td"),o=0;o<t.length;o++)t[o].setAttribute("draggable",!0),t[o].addEventListener("dragover",function(e){this.style.backgroundColor=baseColor.value}),t[o].addEventListener("dragstart",function(e){e.dataTransfer.setData("text/plain",e.target.id);var t=new Image;t.src="eraser.png",e.dataTransfer.setDragImage(t,0,0)})}),document.querySelector("#hueChange").addEventListener("change",function(e){cellLoop("hue-rotate(",this.value,"deg)","#grayScale","#inverting")}),document.querySelector("#grayScale").addEventListener("change",function(e){cellLoop("grayscale(",this.value,"%)","#hueChange","#inverting")}),document.querySelector("#inverting").addEventListener("change",function(e){cellLoop("invert(",this.value/10,")","#grayScale","#hueChange")})}function draw(){var e=document.querySelectorAll("td");document.querySelector("table").style.cursor="url('pencil.png'), auto";for(var t=0;t<e.length;t++)e[t].setAttribute("draggable",!0),e[t].addEventListener("dragover",function(e){this.style.backgroundColor=thiscolor,e.preventDefault()}),e[t].addEventListener("dragstart",function(e){e.dataTransfer.setData("text/plain",e.target.id);var t=new Image;t.src="pencil.png",e.dataTransfer.setDragImage(t,0,0)})}function updateRecent(){var e=document.querySelectorAll(".recents");document.querySelector("#colorPickerMain").addEventListener("change",function(t){""!=thiscolor&&chosenColors.unshift(this.value);for(var o=0;o<e.length;o++)e[o].style.background=chosenColors[o]})}function updateMostUsed(){document.querySelector("#colorPickerMain").addEventListener("change",function(){document.querySelector("#mostUsed").style.background=mostUsed(chosenColors)})}function mostUsed(e){for(var t,o=1,n=0,r=0;r<e.length;r++){for(var c=r;c<e.length;c++)e[r]==e[c]&&n++,o<n&&(o=n,t=e[r]);n=0}return t}function changeText(){"New Canvas"===this.value?this.value="Remove Canvas":"Remove Canvas"===this.value&&(this.value="New Canvas")}function colorToHex(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""}function cellLoop(e,t,o,n,r){for(var c=document.querySelectorAll("td"),l=0;l<c.length;l++)c[l].style.filter=e+t+o;document.querySelector(n).value="0",document.querySelector(r).value="0"}function mousePos(e){var t=document.querySelector("#pixelCanvas > tr:nth-child(1) > td:nth-child(1)").getBoundingClientRect(),o=e.pageX-Math.floor(t.left),n=e.pageY-Math.floor(t.top);document.querySelector("#horizontal").textContent=" "+o+"px ",document.querySelector("#vertical").textContent=" "+n+"px"}function updateFooter(){var e=canvas.getBoundingClientRect(),t=Math.ceil(e.top),o=Math.ceil(e.right),n=Math.ceil(e.bottom),r=Math.ceil(e.left),c=document.querySelector("#input_width").value,l=document.querySelector("#input_height").value;document.querySelector("#rowDisp").textContent=l,document.querySelector("#colDisp").textContent=c,document.querySelector("#htDisp").textContent=n-t-1,document.querySelector("#wtDisp").textContent=o-r-1}function selectDrawTool(){selectors(document.querySelector("#pencil"),document.querySelector("#eraser"))}function selectors(e,t){e.addEventListener("click",function(e){t.classList.remove("selected"),this.classList.add("selected")}),t.addEventListener("click",function(t){e.classList.remove("selected"),this.classList.add("selected")})}function exitDialog(){document.querySelector("section").style.display="block";for(var e=document.querySelectorAll(".openMain"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){document.querySelector("section").style.display="none"})}document.querySelector('input[type="submit"]').addEventListener("click",init),document.querySelector("#pixelCanvas").addEventListener("mouseover",mousePos),tools(),setTimeout(exitDialog,800),document.querySelector('input[type="submit"]').addEventListener("click",changeText);